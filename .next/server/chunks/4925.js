"use strict";exports.id=4925,exports.ids=[4925],exports.modules={24925:(a,b,c)=>{c.d(b,{EventStreamSerde:()=>f});var d=c(38756),e=c(38353);class f{marshaller;serializer;deserializer;serdeContext;defaultContentType;constructor({marshaller:a,serializer:b,deserializer:c,serdeContext:d,defaultContentType:e}){this.marshaller=a,this.serializer=b,this.deserializer=c,this.serdeContext=d,this.defaultContentType=e}async serializeEventStream({eventStream:a,requestSchema:b,initialRequest:c}){let d=this.marshaller,e=b.getEventStreamMember(),f=b.getMemberSchema(e),g=this.serializer,h=this.defaultContentType,i=Symbol("initialRequestMarker"),j={async *[Symbol.asyncIterator](){if(c){g.write(b,c);let a=g.flush();yield{[i]:!0,headers:{":event-type":{type:"string",value:"initial-request"},":message-type":{type:"string",value:"event"},":content-type":{type:"string",value:h}},body:a}}for await(let b of a)yield b}};return d.serialize(j,a=>{if(a[i])return{headers:a.headers,body:a.body};let b=Object.keys(a).find(a=>"__type"!==a)??"",{additionalHeaders:c,body:d,eventType:e,explicitPayloadContentType:g}=this.writeEventBody(b,f,a);return{headers:{":event-type":{type:"string",value:e},":message-type":{type:"string",value:"event"},":content-type":{type:"string",value:g??h},...c},body:d}})}async deserializeEventStream({response:a,responseSchema:b,initialResponseContainer:c}){let e=this.marshaller,f=b.getEventStreamMember(),g=b.getMemberSchema(f).getMemberSchemas(),h=Symbol("initialResponseMarker"),i=e.deserialize(a.body,async a=>{let c=Object.keys(a).find(a=>"__type"!==a)??"",e=a[c].body;if("initial-response"===c){let a=await this.deserializer.read(b,e);return delete a[f],{[h]:!0,...a}}if(!(c in g))return{$unknown:a};{let b=g[c];if(b.isStructSchema()){let f={},g=!1;for(let[h,i]of b.structIterator()){let{eventHeader:b,eventPayload:j}=i.getMergedTraits();if(g=g||!!(b||j),j)i.isBlobSchema()?f[h]=e:i.isStringSchema()?f[h]=(this.serdeContext?.utf8Encoder??d.P)(e):i.isStructSchema()&&(f[h]=await this.deserializer.read(i,e));else if(b){let b=a[c].headers[h]?.value;null!=b&&(i.isNumericSchema()?b&&"object"==typeof b&&"bytes"in b?f[h]=BigInt(b.toString()):f[h]=Number(b):f[h]=b)}}if(g)return{[c]:f}}return{[c]:await this.deserializer.read(b,e)}}}),j=i[Symbol.asyncIterator](),k=await j.next();if(k.done)return i;if(k.value?.[h]){if(!b)throw Error("@smithy::core/protocols - initial-response event encountered in event stream but no response schema given.");for(let[a,b]of Object.entries(k.value))c[a]=b}return{async *[Symbol.asyncIterator](){for(k?.value?.[h]||(yield k.value);;){let{done:a,value:b}=await j.next();if(a)break;yield b}}}}writeEventBody(a,b,c){let d,f=this.serializer,g=a,h=null,i=b.getSchema()[4].includes(a),j={};if(i){let e=b.getMemberSchema(a);if(e.isStructSchema()){for(let[b,d]of e.structIterator()){let{eventHeader:e,eventPayload:f}=d.getMergedTraits();if(f)h=b;else if(e){let e=c[a][b],f="binary";d.isNumericSchema()?f=-0x80000000<=e&&e<=0x80000000-1?"integer":"long":d.isTimestampSchema()?f="timestamp":d.isStringSchema()?f="string":d.isBooleanSchema()&&(f="boolean"),null!=e&&(j[b]={type:f,value:e},delete c[a][b])}}if(null!==h){let b=e.getMemberSchema(h);b.isBlobSchema()?d="application/octet-stream":b.isStringSchema()&&(d="text/plain"),f.write(b,c[a][h])}else f.write(e,c[a])}else throw Error("@smithy/core/event-streams - non-struct member not supported in event stream union.")}else{let[b,d]=c[a];g=b,f.write(15,d)}let k=f.flush();return{body:"string"==typeof k?(this.serdeContext?.utf8Decoder??e.a)(k):k,eventType:g,explicitPayloadContentType:d,additionalHeaders:j}}}}};