"use strict";exports.id=6604,exports.ids=[6604],exports.modules={31219:(a,b,c)=>{c.d(b,{C:()=>g});var d=c(55511),e=c(33873),f=c(33282);let g=a=>{let b=(0,d.createHash)("sha1").update(a).digest("hex");return(0,e.join)((0,f.R)(),".aws","sso","cache",`${b}.json`)}},36604:(a,b,c)=>{c.d(b,{fromSSO:()=>B});var d=c(64262),e=c(55042),f=c(66008),g=c(57885),h=c(55599),i=c(54031);let j=a=>Object.entries(a).filter(([a])=>a.startsWith(h.I.SSO_SESSION+i.Q)).reduce((a,[b,c])=>({...a,[b.substring(b.indexOf(i.Q)+1)]:c}),{});var k=c(29523),l=c(41358);let m=()=>({}),n=async(a={})=>(0,l.TA)(a.configFilepath??(0,g.g)()).then(k.A).then(j).catch(m);var o=c(89701),p=c(30648);class q extends p.m{name="TokenProviderError";constructor(a,b=!0){super(a,b),Object.setPrototypeOf(this,q.prototype)}}var r=c(50580);let s="To refresh this SSO session run 'aws sso login' with the corresponding profile.",t=async(a,b={},d)=>{let{SSOOIDCClient:e}=await c.e(2670).then(c.bind(c,32670)),f=a=>b.clientConfig?.[a]??b.parentClientConfig?.[a]??d?.[a];return new e(Object.assign({},b.clientConfig??{},{region:a??b.clientConfig?.region,logger:f("logger"),userAgentAppId:f("userAgentAppId")}))},u=async(a,b,d={},e)=>{let{CreateTokenCommand:f}=await c.e(2670).then(c.bind(c,32670));return(await t(b,d,e)).send(new f({clientId:a.clientId,clientSecret:a.clientSecret,refreshToken:a.refreshToken,grantType:"refresh_token"}))},v=a=>{if(a.expiration&&a.expiration.getTime()<Date.now())throw new q(`Token is expired. ${s}`,!1)},w=(a,b,c=!1)=>{if(void 0===b)throw new q(`Value not present for '${a}' in SSO Token${c?". Cannot refresh":""}. ${s}`,!1)};var x=c(31219);let{writeFile:y}=c(29021).promises,z=new Date(0),A=async({ssoStartUrl:a,ssoSession:b,ssoAccountId:g,ssoRegion:h,ssoRoleName:i,ssoClient:j,clientConfig:k,parentClientConfig:l,callerClientConfig:m,profile:p,filepath:t,configFilepath:A,ignoreCache:B,logger:C})=>{let D,E,F="To refresh this SSO session run aws sso login with the corresponding profile.";if(b)try{let a=await ((a={})=>async({callerClientConfig:b}={})=>{let c;a.logger?.debug("@aws-sdk/token-providers - fromSso");let d=await (0,f.Y)(a),g=(0,e.Bz)({profile:a.profile??b?.profile}),h=d[g];if(h){if(!h.sso_session)throw new q(`Profile '${g}' is missing required property 'sso_session'.`)}else throw new q(`Profile '${g}' could not be found in shared credentials file.`,!1);let i=h.sso_session,j=(await n(a))[i];if(!j)throw new q(`Sso session '${i}' could not be found in shared credentials file.`,!1);for(let a of["sso_start_url","sso_region"])if(!j[a])throw new q(`Sso session '${i}' is missing required property '${a}'.`,!1);j.sso_start_url;let k=j.sso_region;try{c=await (0,r.v)(i)}catch(a){throw new q(`The SSO session token associated with profile=${g} was not found or is invalid. ${s}`,!1)}w("accessToken",c.accessToken),w("expiresAt",c.expiresAt);let{accessToken:l,expiresAt:m}=c,o={token:l,expiration:new Date(m)};if(o.expiration.getTime()-Date.now()>3e5)return o;if(Date.now()-z.getTime()<3e4)return v(o),o;w("clientId",c.clientId,!0),w("clientSecret",c.clientSecret,!0),w("refreshToken",c.refreshToken,!0);try{z.setTime(Date.now());let d=await u(c,k,a,b);w("accessToken",d.accessToken),w("expiresIn",d.expiresIn);let e=new Date(Date.now()+1e3*d.expiresIn);try{await ((a,b)=>{let c=(0,x.C)(a);return y(c,JSON.stringify(b,null,2))})(i,{...c,accessToken:d.accessToken,expiresAt:e.toISOString(),refreshToken:d.refreshToken})}catch(a){}return{token:d.accessToken,expiration:e}}catch(a){return v(o),o}})({profile:p,filepath:t,configFilepath:A,ignoreCache:B})();D={accessToken:a.token,expiresAt:new Date(a.expiration).toISOString()}}catch(a){throw new d.C(a.message,{tryNextLink:!1,logger:C})}else try{D=await (0,r.v)(a)}catch(a){throw new d.C(`The SSO session associated with this profile is invalid. ${F}`,{tryNextLink:!1,logger:C})}if(new Date(D.expiresAt).getTime()-Date.now()<=0)throw new d.C(`The SSO session associated with this profile has expired. ${F}`,{tryNextLink:!1,logger:C});let{accessToken:G}=D,{SSOClient:H,GetRoleCredentialsCommand:I}=await c.e(4490).then(c.bind(c,64490)),J=j||new H(Object.assign({},k??{},{logger:k?.logger??m?.logger??l?.logger,region:k?.region??h,userAgentAppId:k?.userAgentAppId??m?.userAgentAppId??l?.userAgentAppId}));try{E=await J.send(new I({accountId:g,roleName:i,accessToken:G}))}catch(a){throw new d.C(a,{tryNextLink:!1,logger:C})}let{roleCredentials:{accessKeyId:K,secretAccessKey:L,sessionToken:M,expiration:N,credentialScope:O,accountId:P}={}}=E;if(!K||!L||!M||!N)throw new d.C("SSO returns an invalid temporary credential.",{tryNextLink:!1,logger:C});let Q={accessKeyId:K,secretAccessKey:L,sessionToken:M,expiration:new Date(N),...O&&{credentialScope:O},...P&&{accountId:P}};return b?(0,o.g)(Q,"CREDENTIALS_SSO","s"):(0,o.g)(Q,"CREDENTIALS_SSO_LEGACY","u"),Q},B=(a={})=>async({callerClientConfig:b}={})=>{a.logger?.debug("@aws-sdk/credential-provider-sso - fromSSO");let{ssoStartUrl:c,ssoAccountId:g,ssoRegion:h,ssoRoleName:i,ssoSession:j}=a,{ssoClient:k}=a,l=(0,e.Bz)({profile:a.profile??b?.profile});if(c||g||h||i||j)if(c&&g&&h&&i)return A({ssoStartUrl:c,ssoSession:j,ssoAccountId:g,ssoRegion:h,ssoRoleName:i,ssoClient:k,clientConfig:a.clientConfig,parentClientConfig:a.parentClientConfig,callerClientConfig:a.callerClientConfig,profile:l,filepath:a.filepath,configFilepath:a.configFilepath,ignoreCache:a.ignoreCache,logger:a.logger});else throw new d.C('Incomplete configuration. The fromSSO() argument hash must include "ssoStartUrl", "ssoAccountId", "ssoRegion", "ssoRoleName"',{tryNextLink:!1,logger:a.logger});{let b=(await (0,f.Y)(a))[l];if(!b)throw new d.C(`Profile ${l} was not found.`,{logger:a.logger});if(!(a=>a&&("string"==typeof a.sso_start_url||"string"==typeof a.sso_account_id||"string"==typeof a.sso_session||"string"==typeof a.sso_region||"string"==typeof a.sso_role_name))(b))throw new d.C(`Profile ${l} is not configured with SSO credentials.`,{logger:a.logger});if(b?.sso_session){let e=(await n(a))[b.sso_session],f=` configurations in profile ${l} and sso-session ${b.sso_session}`;if(h&&h!==e.sso_region)throw new d.C("Conflicting SSO region"+f,{tryNextLink:!1,logger:a.logger});if(c&&c!==e.sso_start_url)throw new d.C("Conflicting SSO start_url"+f,{tryNextLink:!1,logger:a.logger});b.sso_region=e.sso_region,b.sso_start_url=e.sso_start_url}let{sso_start_url:e,sso_account_id:g,sso_region:i,sso_role_name:j,sso_session:m}=((a,b)=>{let{sso_start_url:c,sso_account_id:e,sso_region:f,sso_role_name:g}=a;if(!c||!e||!f||!g)throw new d.C(`Profile is configured with invalid SSO credentials. Required parameters "sso_account_id", "sso_region", "sso_role_name", "sso_start_url". Got ${Object.keys(a).join(", ")}
Reference: https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-sso.html`,{tryNextLink:!1,logger:b});return a})(b,a.logger);return A({ssoStartUrl:e,ssoSession:m,ssoAccountId:g,ssoRegion:i,ssoRoleName:j,ssoClient:k,clientConfig:a.clientConfig,parentClientConfig:a.parentClientConfig,callerClientConfig:a.callerClientConfig,profile:l,filepath:a.filepath,configFilepath:a.configFilepath,ignoreCache:a.ignoreCache,logger:a.logger})}}},50580:(a,b,c)=>{c.d(b,{a:()=>f,v:()=>g});var d=c(79748),e=c(31219);let f={},g=async a=>{if(f[a])return f[a];let b=(0,e.C)(a);return JSON.parse(await (0,d.readFile)(b,"utf8"))}}};